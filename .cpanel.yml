---
deployment:
  tasks:
    # 1ï¸âƒ£ Define deployment paths
    - export FRONTEND_PATH=/home/anjonixg/public_html
    - export BACKEND_PATH=/home/anjonixg/backend

    # 2ï¸âƒ£ Build the Vite + React frontend (abort if it fails)
    - cd my-company-site
    - echo "ğŸ“¦ Installing dependencies..."
    - npm install --legacy-peer-deps || { echo "âŒ npm install failed. Aborting."; exit 1; }

    - echo "ğŸ—ï¸ Building Vite React app..."
    - npm run build || { echo "âŒ Vite build failed. Deployment aborted."; exit 1; }

    # 3ï¸âƒ£ Deploy the built frontend to public_html (only if build succeeded)
    - echo "ğŸš€ Copying frontend files to $FRONTEND_PATH..."
    - /bin/cp -R dist/* $FRONTEND_PATH || { echo "âŒ Failed to copy frontend files."; exit 1; }

    # 4ï¸âƒ£ Deploy backend files to backend folder
    - cd ..
    - echo "ğŸ”§ Deploying backend files..."
    - mkdir -p $BACKEND_PATH
    - /bin/cp -R backend/* $BACKEND_PATH || { echo "âŒ Failed to copy backend files."; exit 1; }

    - echo "ğŸ§¾ Deployed files in frontend path ($FRONTEND_PATH):"
    - ls -lh $FRONTEND_PATH

    - echo "ğŸ§¾ Deployed files in backend path ($BACKEND_PATH):"
    - ls -lh $BACKEND_PATH

    # 5ï¸âƒ£ (Optional) Restart your backend (if using Node.js app)
    # Uncomment if using Passenger:
    # - touch $BACKEND_PATH/tmp/restart.txt
    #
    # Or if using PM2:
    # - pm2 restart all

    # âœ… All done
    - echo "âœ… Deployment completed successfully at $(date)"
